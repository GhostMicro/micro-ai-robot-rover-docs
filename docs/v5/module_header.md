# üß† Module: Header (‡∏´‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å)

‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á" (Communicator) ‡πÅ‡∏•‡∏∞ "‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à" (Decision Maker) ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Ghost Micro

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Objectives)
- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Transmitter (‡∏ú‡πà‡∏≤‡∏ô ESP-NOW) ‡πÅ‡∏•‡∏∞ Dashboard (‡∏ú‡πà‡∏≤‡∏ô WebSocket)
- ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á (Higher-Level Logic) ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠ Mission Path
- ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö **Autonomous Hub** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Area Boundary)
- ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô Body via Serial

## üõ†Ô∏è Hardware Requirements
- **MCU 1:** ESP32 (Communication Bridge)
- **Integrated Sensors:**
    - **LDR / Light Sensor:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡πÉ‡∏´‡πâ Body)
    - **Sound Sensor (Digital/Analog):** ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠ SOS (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î SOS ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û)
- **Intelligence Role:** ‡πÄ‡∏õ‡πá‡∏ô "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏Å‡∏•‡∏≤‡∏á" (Central Intelligence)
    - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á/‡πÅ‡∏™‡∏á -> ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü Body
    - ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ -> ‡∏™‡∏±‡πà‡∏á ESP32-CAM ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á SD Card
- **Autonomous Hub Mode:** ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Beacon ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ú‡πà‡∏≤‡∏ô ESP-NOW
- **Expansion Port:** 8-pin Header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏ö AI Modules

## üì° Communication Rules
- **Inbound:** ESP-NOW (‡∏à‡∏≤‡∏Å Transmitter), WiFi (‡∏à‡∏≤‡∏Å GCS)
- **Inter-chip:** UART (ESP32 <-> STM32) @ 115200 bps
- **Outbound:** UART (STM32 -> Nano Body) @ 57600 bps

## üìç Reserved Pins (STM32F103)
| Function               | STM32 Pin            | Note                 |
| :--------------------- | :------------------- | :------------------- |
| **UART1 (Bridge)**     | PA9 (TX), PA10 (RX)  | ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö ESP32           |
| **UART2 (Body)**       | PA2 (TX), PA3 (RX)   | ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Arduino Nano    |
| **Light Sensor (LDR)** | PA0 (ADC)            | ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏™‡∏á         |
| **Sound Sensor**       | PA1 (ADC/Digital)    | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥      |
| **I2C Bus**            | PB6 (SCL), PB7 (SDA) | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Upgrade Modules |
| **Status LED**         | PC13                 | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Debug           |

---

## üíª Latest Firmware: ESP32 MAVLink Gateway

‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ESP32 (Header) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á WiFi (Dashboard) ‡πÅ‡∏•‡∏∞ Pixhawk (TELEM1)

```cpp
#include <HardwareSerial.h>

// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏≠‡∏£‡πå‡∏ï Serial ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Pixhawk (TELEM1)
HardwareSerial PixSerial(1); 

void setup() {
  Serial.begin(115200); // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Debug ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Dashboard ‡∏ú‡πà‡∏≤‡∏ô USB (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
  
  // Pixhawk TELEM1 ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ä‡πâ 57600 Baud
  PixSerial.begin(57600, SERIAL_8N1, 34, 27); 
  
  Serial.println("Ghost Micro V5: Header Gateway Started");
}

void loop() {
  // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Pixhawk -> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Dashboard (Serial/USB)
  while (PixSerial.available() > 0) {
    uint8_t c = PixSerial.read();
    Serial.write(c); 
  }

  // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Dashboard -> ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Pixhawk
  while (Serial.available() > 0) {
    uint8_t c = Serial.read();
    PixSerial.write(c);
  }

  // --- Hub Heartbeat (Broadcast every 1s) ---
  static unsigned long lastBeacon = 0;
  if (millis() - lastBeacon > 1000) {
    lastBeacon = millis();
    // Monitor Hub Signal (Beacon)
    checkHubConnection();
  }
}

void checkHubConnection() {
  // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì 0xBB ‡∏à‡∏≤‡∏Å Hub
  // ‡∏´‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏´‡∏≤‡∏¢‡πÑ‡∏õ -> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Auto RTH ‡πÉ‡∏´‡πâ Body
  Serial.println("Monitoring Hub Connection...");
}
```

---

---

> [!IMPORTANT]
> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤: ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà Code ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Blocking (‡πÄ‡∏ä‡πà‡∏ô `delay`) ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Telemetry
