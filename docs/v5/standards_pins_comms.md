# üìï ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏ô (Standards, Pins & Protocols)

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ "‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ Ghost Micro ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á Pin ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô (Conflict)

---

## üì° 1. Communication Protocols (‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£)

### A. Intra-Modular (‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î)
| Connection               | Protocol     | Baud Rate | Config     |
| :----------------------- | :----------- | :-------- | :--------- |
| Connection               | Protocol     | Baud Rate | Config     |
| :----------------------- | :----------- | :-------- | :--------- |
| **ESP32 <-> AT32 (THAP)**| UART         | 115200    | 8N1        |
| **AT32 (THAP) <-> Nano** | UART (USART3)| 57600     | 8N1        |
| **Vision <-> Dashboard** | MJPEG/WebRTC | WiFi      | Port 81/80 |
| **I2C Devices**          | I2C          | 400kHz*   | Fast Mode  |

> [!NOTE]
> *I2C 400kHz requires THAP Firmware v1.1+ with `HAL_I2C_MAX_CLOCK` set to 400000.

### B. Wireless (‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏¢)
- **Transmitter -> Header:** ESP-NOW (Ch 1, 2.4GHz)
- **Dashboard -> Header:** WebSockets (Port 81)
- **Camera -> Dashboard:** HTTP Stream / WebRTC

---

## üìç 2. Global Pin Allocation Strategy (‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏û‡∏¥‡∏ô)

### ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏û‡∏¥‡∏ô:
1. **‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "Reserved"** ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î
2. **I2C Address Mapping:**
    - `0x3C`: OLED Display (Header/Transmitter)
    - `0x68`: MPU6050 (IMU)
    - `0x1E`: HMC5883L (Compass)
3. **SPI Pins:** ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Hardware SPI ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å (MISO=19, MOSI=23, SCK=18 ‡∏ö‡∏ô ESP32)

---

## üì¶ 3. Data Formatting (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö **Binary Struct** ‡∏´‡∏£‡∏∑‡∏≠ **JSON (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard)** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Command Packet (Header -> Body):**
```cpp
struct BodyControl {
  byte signature = 0xAF; // ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  int8_t throttle;      // -100 ‡∏ñ‡∏∂‡∏á 100
  int8_t steering;      // -100 ‡∏ñ‡∏∂‡∏á 100
  byte command_flags;   // Bit 0: RTH, Bit 1: Area Patrol, Bit 2: Hub Link
  byte illumination;    // 0=Off, 1=On (Searchlight)
  byte sos_signal;      // 0=Normal, 1=SOS Active (Buzzer + Strobe)
  byte lightsFX;        // Bitmask ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡πÄ‡∏ó‡πà‡πÜ (RGB/Signal)
  byte checksum;        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
};

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Vision Result (Vision -> Header):**
```cpp
struct VisionDetection {
  byte signature = 0xFC; // ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡∏ß‡∏á‡∏ï‡∏≤
  byte objectType;      // 1=Human, 2=Obstacle, 3=QR
  int16_t x_pos;        // ‡∏û‡∏¥‡∏Å‡∏±‡∏î X ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠
  int16_t y_pos;        // ‡∏û‡∏¥‡∏Å‡∏±‡∏î Y ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠
};
```
```

---

## üîã 4. Power Monitoring (‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô)

‡πÄ‡∏£‡∏≤‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Battery Monitoring) ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| Target                  | Responsible Module                                                                                      | Detection Method                       |
| :---------------------- | :------------------------------------------------------------------------------------------------------ | :------------------------------------- |
| Target                  | Responsible Module                                                                                      | Detection Method                       |
| :---------------------- | :------------------------------------------------------------------------------------------------------ | :------------------------------------- |
| **Main Battery (V5)**   | **AT32 (THAP Board)**                                                                                   | Power Module (Voltage/Current)        |
| **Motor Battery (>5V)** | **Arduino Nano (Body)**                                                                                 | Voltage Divider (Analog Pin)           |
|                         | - **Movement & Power:** ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå (Movement) ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏™‡πà‡∏≠‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏π‡∏á (High-Intensity LED / Searchlight) |                                        |
|                         | - **‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á (Obstacle Avoidance):** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏ç‡∏≤‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢                                      |                                        |
| **Transmitter Battery** | **ESP32 (Transmitter)**                                                                                 | Internal ADC (Voltage Divider)         |

### ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•:
- **Body** ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ **Header** ‡∏ó‡∏∏‡∏Å‡πÜ 500ms
- **Header** ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ **Dashboard/Transmitter** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Failsafe
